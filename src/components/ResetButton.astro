---
import { setLastReset } from '../utils/timer.js';
---

<button id="resetButton">ðŸ˜… Ela falou de novo!</button>

<script>
  import { setLastReset } from '../utils/timer.js';

  function createConfetti() {
    const colors = ['#ff6b9d', '#ffd93d', '#c06c84', '#6c5b7b', '#355c7d'];
    const confettiCount = 50;

    for (let i = 0; i < confettiCount; i++) {
      const confetti = document.createElement('div');
      confetti.className = 'confetti';
      confetti.style.left = Math.random() * 100 + 'vw';
      confetti.style.backgroundColor =
        colors[Math.floor(Math.random() * colors.length)];
      confetti.style.animationDelay = Math.random() * 0.5 + 's';
      confetti.style.animationDuration = Math.random() * 2 + 2 + 's';
      document.body.appendChild(confetti);

      setTimeout(() => {
        confetti.remove();
      }, 3000);
    }
  }

  function shakeScreen() {
    document.body.style.animation = 'shake 0.5s';
    setTimeout(() => {
      document.body.style.animation = '';
    }, 500);
  }

  // Adiciona animaÃ§Ã£o de shake ao CSS
  if (!document.querySelector('#shake-animation')) {
    const style = document.createElement('style');
    style.id = 'shake-animation';
    style.textContent = `
      @keyframes shake {
        0%, 100% { transform: translateX(0); }
        10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
        20%, 40%, 60%, 80% { transform: translateX(5px); }
      }
    `;
    document.head.appendChild(style);
  }

  if (typeof window !== 'undefined') {
    const resetBtn = document.getElementById('resetButton');
    if (resetBtn) {
      resetBtn.addEventListener('click', async () => {
        // Adiciona classe de animaÃ§Ã£o ao botÃ£o
        resetBtn.classList.add('button-clicked');

        // Cria confetes
        createConfetti();

        // Chacoalha a tela
        shakeScreen();

        // Reseta o timer
        await setLastReset();

        // Remove a classe apÃ³s a animaÃ§Ã£o
        setTimeout(() => {
          resetBtn.classList.remove('button-clicked');
        }, 600);

        // Recarrega apÃ³s um pequeno delay para ver os efeitos
        setTimeout(() => {
          location.reload();
        }, 800);
      });
    }
  }
</script>
